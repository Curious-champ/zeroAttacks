import socketio
from random import choice, randint, choices

false_attacks={
    
    "dos_goldeneye":[
        [80,7,6,381,11632,381,0,54.42857143,144.0044642,5792,0,1938.666667,2544.918912,5792,0,858.0714286,1855.776448,3443906.225,232,200,32,1,0,0,924.0769231,29200,235,0,0,0,0,54.42857143,1938.666667,381,11632,7,6],
        [80,7,5,414,11632,414,0,59.14285714,156.4772918,7288,0,2326.4,3351.290617,7288,0,926.6153846,2254.526319,5082888.923,232,168,32,1,0,0,1003.833333,29200,235,0,0,0,0,59.14285714,2326.4,414,11632,7,5],
        [80,8,6,325,11632,325,0,40.625,114.9048519,5792,0,1938.666667,2544.918912,5792,0,797.1333333,1802.932804,3250566.695,264,200,32,1,0,0,854.0714286,29200,235,0,0,0,0,40.625,1938.666667,325,11632,8,6],
        [80,8,5,537,11632,537,0,67.125,189.8581707,10184,0,2326.4,4437.056321,10184,0,869.2142857,2710.683427,7347804.643,264,168,32,1,0,0,936.0769231,29200,235,0,0,0,0,67.125,2326.4,537,11632,8,5],
        [80,8,6,308,11632,308,0,38.5,108.8944443,5840,0,1938.666667,2550.37524,5840,0,796.0,1806.007119,3261661.714,264,200,32,1,0,0,852.8571429,29200,235,0,0,0,0,38.5,1938.666667,308,11632,8,6],
        [80,8,6,411,11632,411,0,51.375,145.3104435,5792,0,1938.666667,2544.918912,5792,0,802.8666667,1801.460315,3245259.267,264,200,32,1,0,0,860.2142857,29200,235,0,0,0,0,51.375,1938.666667,411,11632,8,6],
        [80,8,6,279,11632,279,0,34.875,98.64139598,4392,0,1938.666667,2190.718847,4392,0,794.0666667,1629.340992,2654752.067,264,200,32,1,0,0,850.7857143,29200,235,0,0,0,0,34.875,1938.666667,279,11632,8,6],
        ],
    
    "heartbleed":[
        [444,2685,1729,8299,7556917,517,0,3.090875233,16.85842056,17376,0,4370.686524,2566.935004,17376,0,1713.525708,2669.389319,7125639.337,85928,55336,32,118,0,0,1713.91391,29200,235,0,0,0,0,3.090875233,4370.686524,8299,7556917,2685,1729],
        [444,2792,2110,13712,7878135,5792,0,4.911174785,110.3764478,14480,0,3733.71327,2366.09794,14480,0,1610.776871,2414.090913,5827834.935,89356,67520,32,120,0,0,1611.105467,235,235,0,0,0,0,4.911174785,3733.71327,13712,7878135,2792,2110],
        [444,2794,2130,12264,7879536,4344,0,4.38940587,83.21163543,13032,0,3699.312676,2314.906035,13032,0,1603.27797,2381.909586,5673493.274,89408,68160,32,120,0,0,1603.603574,235,235,0,0,0,0,4.38940587,3699.312676,12264,7879536,2794,2130],
        [444,2791,2114,13712,7878088,5792,0,4.912934432,110.3961875,13032,0,3726.626301,2284.046514,13032,0,1609.782307,2377.954578,5654667.975,89312,67648,32,120,0,0,1610.110499,235,235,0,0,0,0,4.912934432,3726.626301,13712,7878088,2791,2114],
        [444,2782,2089,9368,7882432,1448,0,3.36736161,30.50502966,17376,0,3773.303973,2372.06653,17376,0,1620.124795,2427.68666,5893662.519,89024,66848,32,120,0,0,1620.457401,235,235,0,0,0,0,3.36736161,3773.303973,9368,7882432,2782,2089],
    ],
    "ftp_prator":[
        [80,3,1,0,0,0,0,0.0,0.0,0,0,0.0,0.0,0,0,0.0,0.0,0.0,104,40,32,0,0,0,0.0,29200,28960,0,0,0,0,0.0,0.0,0,0,3,1,],
        [21,1,1,0,0,0,0,0.0,0.0,0,0,0.0,0.0,0,0,0.0,0.0,0.0,32,32,32,0,0,1,0.0,229,227,0,0,0,0,0.0,0.0,0,0,1,1,],
        [21,1,1,0,0,0,0,0.0,0.0,0,0,0.0,0.0,0,0,0.0,0.0,0.0,32,32,32,0,0,1,0.0,229,227,0,0,0,0,0.0,0.0,0,0,1,1,],
        [21,1,1,0,0,0,0,0.0,0.0,0,0,0.0,0.0,0,0,0.0,0.0,0.0,32,32,32,0,0,1,0.0,229,227,0,0,0,0,0.0,0.0,0,0,1,1,],
        [21,1,1,0,0,0,0,0.0,0.0,0,0,0.0,0.0,0,0,0.0,0.0,0.0,32,32,32,0,0,1,0.0,229,227,0,0,0,0,0.0,0.0,0,0,1,1,],
        [21,1,1,0,0,0,0,0.0,0.0,0,0,0.0,0.0,0,0,0.0,0.0,0.0,32,32,32,0,0,1,0.0,229,227,0,0,0,0,0.0,0.0,0,0,1,1,],
    ],

    "infiltration":[
        [444,2,0,12,0,6,6,6.0,0.0,0,0,0.0,0.0,6,6,6.0,0.0,0.0,40,0,20,1,0,0,9.0,255,-1,0,0,0,0,6.0,0.0,12,0,2,0],
        [444,5523,5525,2866110,33406,1274,0,518.940793,204.2035303,267,0,6.046334842,3.512317683,1274,0,262.4233867,294.3120341,86619.57344,110472,110512,20,5522,0,1,262.4471398,8192,3294,0,0,0,0,518.940793,6.046334842,2866110,33406,5523,5525],
        [444,15,15,0,90,0,0,0.0,0.0,6,6,6.0,0.0,6,0,2.903225806,3.048003048,9.290322581,460,300,28,0,0,1,3.0,8192,0,0,0,0,0,0.0,6.0,0,90,15,15],
        [444,4376,4374,2321478,26244,1273,6,530.5022852,262.7688148,6,6,6.0,0.0,1273,6,268.2811107,321.4144458,103307.246,87520,87480,20,4375,0,0,268.3117714,3294,3294,0,0,0,0,530.5022852,6.0,2321478,26244,4376,4374],
        [444,3398,3398,1645814,20643,1153,0,484.3478517,302.0574541,267,0,6.075044144,4.47864339,1153,0,245.1753715,320.6415749,102811.0196,67972,67972,20,3397,0,1,245.2114479,8192,3977,0,0,0,0,484.3478517,6.075044144,1645814,20643,3398,3398],
        [444,3813,3811,1752551,22866,1271,6,459.6252295,246.7309368,6,6,6.0,0.0,1271,6,232.8423607,286.1621682,81888.78653,76260,76220,20,3812,0,0,232.8729014,3294,3294,0,0,0,0,459.6252295,6.0,1752551,22866,3813,3811],
        [444,48,52,12042,586,1460,0,250.875,422.7945341,267,0,11.26923077,36.2470366,1460,0,125.029703,314.9169241,99172.66911,972,1052,20,47,0,1,126.28,8192,538,0,0,0,0,250.875,11.26923077,12042,586,48,52],
        [444,3733,3732,1827335,22392,1271,6,489.5084383,269.6103044,6,6,6.0,0.0,1271,6,247.7542191,307.8845905,94792.9211,74660,74640,20,3732,0,0,247.7874079,3977,3977,0,0,0,0,489.5084383,6.0,1827335,22392,3733,3732],
        [444,2252,2250,929308,13500,1272,6,412.6589698,304.9632397,6,6,6.0,0.0,1272,6,209.3746391,296.4006569,87853.3494,45040,45000,20,2251,0,0,209.4211462,3294,3294,0,0,0,0,412.6589698,6.0,929308,13500,2252,2250],
        [444,1157,1157,319630,6942,1271,6,276.2575627,265.155894,6,6,6.0,0.0,1271,6,141.1088553,231.0500967,53384.14718,23140,23140,20,1156,0,1,141.1698358,255,3977,0,0,0,0,276.2575627,6.0,319630,6942,1157,1157],
    ],

    "portscan":[
        [80,1,1,0,0,0,0,0.0,0.0,0,0,0.0,0.0,0,0,0.0,0.0,0.0,32,32,32,0,0,1,0.0,253,243,0,0,0,0,0.0,0.0,0,0,1,1],
        [80,3,1,0,0,0,0,0.0,0.0,0,0,0.0,0.0,0,0,0.0,0.0,0.0,104,40,32,0,0,0,0.0,29200,28960,0,0,0,0,0.0,0.0,0,0,3,1],
        [80,2,1,8,2,6,2,4.0,2.828427125,2,2,2.0,0.0,6,2,3.0,2.0,4.0,44,24,20,1,0,0,4.0,1024,29200,0,0,0,0,4.0,2.0,8,2,2,1],
        [443,1,1,2,6,2,2,2.0,0.0,6,6,6.0,0.0,6,2,3.333333333,2.309401077,5.333333333,24,20,24,0,0,1,5.0,1024,0,0,0,0,0,2.0,6.0,2,6,1,1],
        [22,2,1,8,2,6,2,4.0,2.828427125,2,2,2.0,0.0,6,2,3.0,2.0,4.0,44,24,20,1,0,0,4.0,1024,29200,0,0,0,0,4.0,2.0,8,2,2,1],
        [21,2,1,8,2,6,2,4.0,2.828427125,2,2,2.0,0.0,6,2,3.0,2.0,4.0,44,24,20,1,0,0,4.0,1024,29200,0,0,0,0,4.0,2.0,8,2,2,1],
        [443,1,1,2,6,2,2,2.0,0.0,6,6,6.0,0.0,6,2,3.333333333,2.309401077,5.333333333,24,20,24,0,0,1,5.0,1024,0,0,0,0,0,2.0,6.0,2,6,1,1],
        [443,1,1,2,6,2,2,2.0,0.0,6,6,6.0,0.0,6,2,3.333333333,2.309401077,5.333333333,24,20,24,0,0,1,5.0,1024,0,0,0,0,0,2.0,6.0,2,6,1,1],
        [444,1,1,2,6,2,2,2.0,0.0,6,6,6.0,0.0,6,2,3.333333333,2.309401077,5.333333333,24,20,24,0,0,1,5.0,1024,0,0,0,0,0,2.0,6.0,2,6,1,1],
    ]
        }

def choose_random_attack(attacks=false_attacks):
    attack_type=choice(list(attacks.keys()))
    attack=choice(attacks[attack_type])
    return attack_type, attack

class Client:
    def __init__(self, port):
        self.sio = socketio.Client()

        @(self.sio).event
        def connect():
            print('CICFlowMeter connected to server')

        self.connectToServer(port)

    def sendToServer(self, func, data,generate_false_attacks):

        if generate_false_attacks and (choices([0,1],weights=[0.97,0.03])[0]):
            number_of_false_attacks=randint(0,2)
            for i in range(number_of_false_attacks):
                attack_type, attack=choose_random_attack(false_attacks)
                data["data"].append(attack)


        if len(data["data"]) !=0:
            self.sio.emit(func, data)
        

    def connectToServer(self, port):
        self.sio.connect(f'http://localhost:{port}', wait_timeout = 10)

    def disconnectFromServer(self):
        self.sio.disconnect()

    # events..


if __name__ == '__main__':
    connection = Client(8001)
    connection.sendToServer("CicFlowMeter", {
                    "columns": "dst_port", "data":80})
    # connection.sio.wait()


    # connection.sio.sleep(1)
    # connection.disconnectFromServer()

